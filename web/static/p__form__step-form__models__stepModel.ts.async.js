(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{k5Mu:function(e,t,r){"use strict";r.r(t);var n=r("gWZ8"),a=r.n(n),u=r("jHYr"),o=r.n(u),s=r("d6i3"),c=r.n(s),i=r("p0pE"),p=r.n(i),l=(r("1l/V"),r("io9h"));function d(e){return Object(l.a)("/api/transform/info")}function f(e){return Object(l.a)("/api/transform/".concat(e.id),{method:"POST",params:{id:e.id},data:e})}function m(e){return Object(l.a)("/api/transform",{method:"POST",data:e})}function y(e){return Object(l.a)("/api/transform/debug",{method:"POST",data:e})}function v(e){return Object(l.a)("/api/transform/".concat(e.id))}function x(e){return Object(l.a)("/api/transform/".concat(e.id,"/run"),{method:"POST",params:{id:e.id},data:e})}var b={namespace:"formStepForm",state:{current:"list",namespaces:[],targetKeys:[],resourceColumns:[],detailColumns:[],ready:!1},effects:{initStepFromList:c.a.mark(function e(t,r){var n,a,u,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,a=r.call,u=r.put,e.next=4,a(v,n);case 4:return o=e.sent,e.next=7,u({type:"updateColumnDetail",payload:o.data.resources.columns});case 7:return e.next=9,u({type:"saveStepFormData",payload:p()({},n,o.data.detail)});case 9:return e.next=11,u({type:"saveCurrentStep",payload:"result"});case 11:case"end":return e.stop()}},e)}),initSource:c.a.mark(function e(t,r){var n,a,u;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o()(t),n=r.call,a=r.put,e.next=4,n(d);case 4:return u=e.sent,e.next=7,a({type:"sourceTableInit",payload:u.data});case 7:return e.next=9,a({type:"updateLoading",ready:!0});case 9:case"end":return e.stop()}},e)}),initSourceColumn:c.a.mark(function e(t,r){var n,u,s,i,p,l,d,f,m;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o()(t),n=r.put,u=r.select,e.next=4,u(function(e){return e.formStepForm.targetKeys});case 4:return s=e.sent,e.next=7,u(function(e){return e.formStepForm.detailColumns});case 7:return i=e.sent,e.next=10,u(function(e){return e.formStepForm.resourceColumns});case 10:return p=e.sent,l=i.filter(function(e){return s.indexOf(e.id)>=0}),d=l.map(function(e){return e.id}),f=p.filter(function(e){return s.indexOf(e.id)>=0&&d.indexOf(e.id)<0}),m=[].concat(a()(l),a()(f)),e.next=17,n({type:"updateColumnDetail",payload:m});case 17:case"end":return e.stop()}},e)}),submitStepForm:c.a.mark(function e(t,r){var n,a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r.call,a=r.put,e.next=4,a({type:"saveStepFormData",payload:n});case 4:return e.next=6,a({type:"saveCurrentStep",payload:"result"});case 6:case"end":return e.stop()}},e)}),submitTransformTable:c.a.mark(function e(t,r){var n,a,u,o,s,i,l,d,y;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,a=t.callback,u=r.call,o=r.put,s=r.select,i=void 0===n.id?m:f,e.next=5,s(function(e){return e.formStepForm.detailColumns});case 5:return l=e.sent,e.next=8,u(i,p()({},n,{columns:l}));case 8:if(!(d=e.sent).success){e.next=15;break}return y=p()({},n,d.data),e.next=13,o({type:"transform/"+(i===f?"updateList":"createOne"),payload:y});case 13:return e.next=15,o({type:"clearForm"});case 15:setTimeout(a,100,d);case 16:case"end":return e.stop()}},e)}),submitDebugTransformTable:c.a.mark(function e(t,r){var n,a,u,o,s,i,l;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,a=t.callback,u=r.call,r.put,o=r.select,s=y,e.next=5,o(function(e){return e.formStepForm.detailColumns});case 5:return i=e.sent,e.next=8,u(s,p()({},n,{columns:i}));case 8:l=e.sent,setTimeout(a,100,l);case 10:case"end":return e.stop()}},e)}),runCurrentTransform:c.a.mark(function e(t,r){var n,a,u,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,a=t.callback,u=r.call,e.next=4,u(x,p()({},n));case 4:o=e.sent,setTimeout(a,100,o);case 6:case"end":return e.stop()}},e)})},reducers:{updateLoading:function(e,t){var r=t.ready;return p()({},e,{ready:r})},updateTarget:function(e,t){var r=t.payload;return p()({},e,{targetKeys:r})},clearForm:function(e,t){return o()(t),p()({},e,{targetKeys:[],detail:void 0})},updateColumnDetail:function(e,t){var r=t.payload;return p()({},e,{detailColumns:r,targetKeys:r.map(function(e){return e.id})})},saveCurrentStep:function(e,t){var r=t.payload;return p()({},e,{current:r})},sourceTableInit:function(e,t){var r=t.payload;return p()({},e,{resourceColumns:r.columns,namespaces:r.namespaces})},saveStepFormData:function(e,t){var r=t.payload;return p()({},e,{detail:r})},deleteColumnTable:function(e,t){var r=t.id;return p()({},e,{detailColumns:e.detailColumns.filter(function(e){return e.id!==r}),targetKeys:e.targetKeys.filter(function(e){return r!==e})})},updateColumnTable:function(e,t){var r=t.payload;return p()({},e,{detailColumns:e.detailColumns.map(function(e){return e.id===r.id?p()({},e,r):e})})}},subscriptions:{setup:function(e){var t=e.history,r=e.dispatch;t.listen(function(e,t){"/transform"===e.pathname&&(r({type:"initSource"}),r({type:"transform/fetch"}))})}}};t.default=b}}]);