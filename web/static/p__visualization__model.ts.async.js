(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"Dz5+":function(e,a,t){"use strict";t.r(a);var r=t("gWZ8"),n=t.n(r),s=t("p0pE"),c=t.n(s),l=(t("miYZ"),t("tsqr")),i=t("d6i3"),u=t.n(i),o=t("1l/V"),p=t.n(o),d=t("sy1d");function b(){return f.apply(this,arguments)}function f(){return(f=p()(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d.a)(" /api/tables",{params:{_time:(new Date).getTime()}}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=p()(u.a.mark(function e(a){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d.a)("/api/table/".concat(a),{params:{_time:(new Date).getTime()}}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function h(e,a){return y.apply(this,arguments)}function y(){return(y=p()(u.a.mark(function e(a,t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d.a)("/api/search/".concat(a),{params:c()({_time:(new Date).getTime()},t),data:t,method:"POST"}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var x={namespace:"visualization",state:{tables:[],relatedTables:[],details:[],search:"",selectTable:"",limit:500,currentDisplayTables:[],selectRelatedTableKeys:[],errorDisplay:!1,errorCode:0,errorMsg:""},effects:{fetchTables:u.a.mark(function e(a,t){var r,n,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.payload,r=t.call,n=t.put,e.next=4,r(b);case 4:return s=e.sent,e.next=7,n({type:"save",payload:{tables:s.data.data}});case 7:case"end":return e.stop()}},e)}),doRefresh:u.a.mark(function e(a,t){var r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.call,r=t.put,e.next=3,r({type:"save",payload:{tables:[],relatedTables:[],details:[],selectTable:"",limit:-1,currentDisplayTables:[],selectRelatedTableKeys:[],errorDisplay:!1,errorCode:0,errorMsg:""}});case 3:return e.next=5,r({type:"fetchTables"});case 5:case"end":return e.stop()}},e)}),submitSearch:u.a.mark(function e(a,t){var r,n,s,c,i,o,p,d;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.payload,r=t.call,n=t.put,s=t.select,e.next=4,s(function(e){return e.visualization});case 4:return c=e.sent,i=c.limit,o=c.search,p=c.selectTable,e.next=10,r(h,p,{limit:i,search:o});case 10:if(0===(d=e.sent).code){e.next=15;break}return e.next=14,n({type:"save",payload:{errorDisplay:!0,errorCode:d.code,errorMsg:d.msg}});case 14:return e.abrupt("return");case 15:return e.next=17,n({type:"saveTableSearch",payload:d.data});case 17:l.a.destroy();case 21:case"end":return e.stop()}},e)}),hiddenTableDetail:u.a.mark(function e(a,t){var r,n,s,l,i,o,p,d;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.payload,t.call,n=t.put,s=t.select,l=r.tableName,e.next=5,s(function(e){return e.visualization.details.filter(function(e){return e.tableName==l})});case 5:i=e.sent,o=0;case 7:if(!(o<i.length)){e.next=15;break}return p=i[o],d=c()({},p,{show:r.check}),e.next=12,n({type:"saveTableSearch",payload:d});case 12:o++,e.next=7;break;case 15:case"end":return e.stop()}},e)}),submitSelectTable:u.a.mark(function e(a,t){var r,n,s,c;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.payload,n=t.call,s=t.put,e.next=4,s({type:"save",payload:{selectTable:r,selectRelatedTableKeys:[]}});case 4:return e.next=6,n(m,r);case 6:return c=e.sent,e.next=9,s({type:"save",payload:{relatedTables:Array.isArray(c.data.data)?c.data.data:[]}});case 9:case 12:case"end":return e.stop()}},e)}),submitSearchAll:u.a.mark(function e(a,t){var r,n,s,c,l,i,o,p,d,b,f,m,v,h;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.payload,t.call,n=t.put,s=t.select,e.next=5,s(function(e){return e.visualization});case 5:return c=e.sent,l=c.selectTable,i=c.search,o=c.limit,e.next=11,s(function(e){return e.visualization});case 11:if(p=e.sent,void 0!==p.current){e.next=16;break}return e.next=16,n({type:"submitSearchOne",payload:{params:{selectTable:l,search:i,limit:o,table:l}}});case 16:d=!0,b=!1,f=void 0,e.prev=19,m=r[Symbol.iterator]();case 21:if(d=(v=m.next()).done){e.next=31;break}return h=v.value,e.next=26,n({type:"saveTableSearch",payload:{tableName:h,loading:!0,show:!0}});case 26:return e.next=28,n({type:"submitSearchOne",payload:{params:{selectTable:l,search:i,limit:o,table:h}}});case 28:d=!0,e.next=21;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(19),b=!0,f=e.t0;case 37:e.prev=37,e.prev=38,d||null==m.return||m.return();case 40:if(e.prev=40,!b){e.next=43;break}throw f;case 43:return e.finish(40);case 44:return e.finish(37);case 45:case"end":return e.stop()}},e,null,[[19,33,37,45],[38,,40,44]])}),submitSearchOne:u.a.mark(function e(a,t){var r,n,s,l;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.payload,n=t.call,s=t.put,e.next=4,n(h,r.params.table,r.params);case 4:return l=e.sent,e.next=7,s({type:"saveTableSearch",payload:c()({},l.data,{loading:!1})});case 7:case"end":return e.stop()}},e)}),startChangeCurrentTable:u.a.mark(function e(a,t){var r,n,s,c;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.tableName,t.call,n=t.put,s=t.select,e.next=4,s(function(e){return e.visualization});case 4:if(c=e.sent,c.selectTable===r){e.next=9;break}return e.next=9,n({type:"submitSelectTable",payload:r});case 9:return e.next=11,n({type:"changeCurrentTable",tableName:r});case 11:case"end":return e.stop()}},e)})},reducers:{save:function(e,a){var t=a.payload;return c()({},e,t)},saveTableSearch:function(e,a){var t,r=a.payload;if(void 0!==(t=void 0!==e&&r.tableName===e.selectTable?c()({},e,{current:r}):e)&&0===t.details.filter(function(e){return e.tableName===r.tableName}).length){var s=[].concat(n()(t.details),[r]);return c()({},t,{details:s})}if(void 0!==t){var l=t.details.map(function(e){return e.tableName===r.tableName?r:e});return c()({},t,{details:l})}},changeCurrentTable:function(e,a){var t=a.tableName;if(void 0!==e){var r=e.details.filter(function(e){return e.tableName===t});if(r.length>0){var n=r[0];return c()({},e,{current:n,selectTable:n.tableName,search:n.search,limit:n.limit})}}return e},deleteTable:function(e,a){var t=a.tableName;return c()({},e,{details:e.details.filter(function(e){return e.tableName!==t})})}}};a.default=x}}]);